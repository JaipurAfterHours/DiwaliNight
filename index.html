<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Diwali Night Registration ‚ú®</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<style>
:root{
  --cream:#fdfaf7; --gold:#d8b384; --dark-gold:#b89263; --text:#2b2b2b; --border:#e9dfd2; --sparkle:rgba(255,215,150,0.55);
}
*{box-sizing:border-box}
body{ font-family:Inter,system-ui,Arial,sans-serif; background:var(--cream); color:var(--text); margin:0; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
header{ text-align:center; background:linear-gradient(135deg,#fff5ea,#fdecd2); padding:56px 20px 32px; border-bottom:1px solid var(--border); position:relative; overflow:hidden;}
header::before, header::after{ content:"ü™î"; position:absolute; font-size:3.6rem; opacity:0.16; }
header::before{ left:8%; top:14%; animation:float 5s ease-in-out infinite alternate; }
header::after{ right:8%; bottom:8%; animation:float 6s ease-in-out infinite alternate-reverse; }
@keyframes float{ from{transform:translateY(0)} to{transform:translateY(-14px)} }
header h1{ font-family:'Playfair Display',serif; font-size:2.6rem; color:var(--dark-gold); margin:0 0 8px; }
header p{ max-width:780px; margin:0 auto; font-size:1rem; line-height:1.6; color:rgba(43,43,43,0.95); }
header a{ color:var(--dark-gold); text-decoration:none; font-weight:600; }
.header-note{ margin-top:12px; color:#6a5846; font-size:0.95rem; }

.container{ max-width:760px; margin:28px auto; padding:0 18px; }
.details-box{ background:#fff; border:1px solid var(--border); border-radius:12px; padding:22px 26px; box-shadow:0 6px 18px rgba(0,0,0,0.04); color:#4b4036; margin-bottom:22px; }
.details-box ul{ margin:8px 0 0 18px; padding:0; color:#4b4036; }
.details-grid{ display:flex; gap:12px; flex-wrap:wrap; margin-top:14px; }
.detail-pill{ background:linear-gradient(180deg,#fffaf3,#fff6ea); border:1px solid var(--border); padding:10px 12px; border-radius:10px; font-weight:600; color:#6e543b; box-shadow:0 2px 8px rgba(0,0,0,0.03); }

form{ background:#fff; border-radius:12px; border:1px solid var(--border); box-shadow:0 8px 30px rgba(0,0,0,0.06); overflow:hidden; }
.step{ display:none; padding:36px 28px; text-align:center; }
.step.active{ display:block; animation:fadeIn .35s ease; }
@keyframes fadeIn{ from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:translateY(0)} }
h2{ font-family:'Playfair Display',serif; color:var(--dark-gold); margin:0 0 16px; font-size:1.6rem; }
.input, select{ width:86%; max-width:460px; padding:12px 14px; margin:10px auto; display:block; border-radius:8px; border:1px solid var(--border); background:#fff; font-size:1rem; }
.input:focus, select:focus{ outline:none; border-color:var(--gold); box-shadow:0 0 0 5px rgba(216,179,132,0.12); }
.small{ font-size:.92rem; color:#6b5b4b; margin-top:6px; }
.person-fields{ background:#fffaf7; border:1px solid var(--border); border-radius:10px; padding:12px; width:86%; margin:12px auto; text-align:left; }
.person-fields h4{ margin:0 0 8px; font-size:1rem; color:#6e543b; }
.controls{ display:flex; justify-content:center; gap:12px; margin-top:10px; flex-wrap:wrap; }
.btn{ background:var(--gold); color:#fff; padding:10px 20px; border-radius:8px; border:none; cursor:pointer; font-weight:600; transition:all .18s; }
.btn.secondary{ background:#fff; color:var(--dark-gold); border:1px solid var(--border); }
.btn:hover{ transform:translateY(-3px); box-shadow:0 6px 18px rgba(0,0,0,0.06); }
.summary{ margin:14px auto 4px; font-weight:700; color:#7a4f34; }
#qr{ width:200px; margin:14px auto; border-radius:8px; border:1px solid var(--border); display:block; }
#successMsg{ display:none; background:#e8f8e3; color:#24562b; padding:12px; border-radius:10px; width:88%; margin:18px auto; font-weight:600; }
.note{ font-size:.9rem; color:#7b6a5b; margin-top:6px; }
.sparkle{ position:absolute; inset:0; pointer-events:none; }
.sparkle span{ position:absolute; width:6px; height:6px; background:var(--sparkle); border-radius:50%; animation:spark 3s infinite ease-in-out; opacity:0; }
@keyframes spark{ 0%,100%{ opacity:0; transform:translateY(0) scale(.8) } 50%{ opacity:1; transform:translateY(-8px) scale(1.2) } }
@media (max-width:560px){ header h1{ font-size:1.8rem } .input, select, .person-fields{ width:94% } .detail-pill{ flex:1 } }

#loadingOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:9999;justify-content:center;align-items:center;}
#loadingOverlay div{width:60px;height:60px;border:6px solid #f3f3f3;border-top:6px solid #d8b384;border-radius:50%;animation:spin 1s linear infinite;}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

.modal {display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.45); z-index: 10000; justify-content:center; align-items:center; opacity:0; transition: opacity 0.35s ease;}
.modal.show{display:flex; opacity:1;}
.modal-content{ background:#fff; padding:28px 32px; border-radius:14px; max-width:360px; width:90%; text-align:center; box-shadow:0 10px 28px rgba(0,0,0,0.25); font-family:Inter,Arial,sans-serif; transform:translateY(-20px); transition:transform 0.35s ease;}
.modal.show .modal-content{transform:translateY(0);}
.modal-content h2{color:#b89263; margin-bottom:12px;}
.modal-content p{color:#4b4036; margin-bottom:20px; font-size:1rem;}
.modal-content button{padding:10px 20px; background:#d8b384; color:#fff; border:none; border-radius:8px; cursor:pointer; font-weight:600; transition:background 0.2s;}
.modal-content button:hover{background:#b89263;}
</style>
</head>
<body>
<header>
  <h1>‚ú® Diwali Night: A Night Under The Sky ‚ú®</h1>
  <p><strong>Jaipur After Hours x The Forresta</strong></p>
  <p class="header-note">üìç <a href="https://maps.app.goo.gl/V9sfvTeTSCVdNRBR9" target="_blank" rel="noopener">The Forresta, Jaipur</a>  &nbsp; | &nbsp; üìÖ 17th October  &nbsp; | &nbsp; üëó Ethnic</p>
  <div class="sparkle" aria-hidden="true"></div>
</header>

<div class="container">
  <div class="details-box" role="region" aria-label="Event details">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
      <div>
        <p style="margin:0 0 8px 0;"><strong>Not your usual Diwali ‚Äî this is <span style="color:var(--dark-gold)">Jaipur After Hours</span></strong></p>
        <ul>
          <li>üíÉ Desi beats & elegant fits</li>
          <li>üî• Fire dance floors</li>
          <li>üåå Celebrate Diwali under the stars</li>
        </ul>
      </div>
      <div class="details-grid" style="align-items:center">
        <div class="detail-pill">üë® Male Stag ‚Ä¢ ‚Çπ2000</div>
        <div class="detail-pill">üë© Female Stag ‚Ä¢ ‚Çπ1500</div>
        <div class="detail-pill">üíë Couple ‚Ä¢ ‚Çπ2500</div>
      </div>
    </div>
    <div style="margin-top:12px" class="note">NOTE: On-spot charges may differ.</div>
  </div>

  <form id="diwaliForm" novalidate>
    <!-- STEP 1 -->
    <div class="step active" id="step1">
      <h2>Main Person</h2>
      <input class="input" id="main_name" placeholder="Full name" required>
      <input class="input" id="main_instagram" placeholder="Instagram handle" required>
      <input class="input" id="main_mobile" placeholder="Mobile number" required>
      <input class="input" id="main_email" placeholder="Email" type="email" required>
      <select class="input" id="main_gender" required>
        <option value="">Select gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
      <div class="controls">
        <button type="button" class="btn" id="next1">Next</button>
      </div>
    </div>

    <!-- STEP 2: Guests -->
    <div class="step" id="step2">
      <h2>Guests</h2>
      <div id="guestsContainer"></div>
      <div class="controls">
        <button type="button" class="btn secondary" id="addGuest">Add Guest</button>
      </div>
      <div class="controls">
        <button type="button" class="btn secondary" id="back2">Back</button>
        <button type="button" class="btn" id="next2">Next</button>
      </div>
    </div>

    <!-- STEP 3: Payment -->
    <div class="step" id="step3">
    <h2>Payment</h2>
    <p class="small">Scan QR or UPI and upload screenshot.</p>
  
  <!-- QR Code Image -->
  <img id="qr" src="Diwali Party QR Code.jpg" alt="Scan to pay via UPI">

  <input type="file" accept="image/*" id="screenshot" required>
  <input class="input" id="upiTxn" placeholder="UPI Transaction ID" required>
  <div class="summary">Total Amount: <span id="totalAmount">‚Çπ0</span></div>
  <div class="controls">
    <button type="button" class="btn secondary" id="back3">Back</button>
    <button type="submit" class="btn" id="submitBtn">Submit</button>
  </div>
</div>



  <div id="loadingOverlay"><div></div></div>

  <div class="modal" id="successModal">
    <div class="modal-content">
      <h2>üéâ Registration Successful!</h2>
      <p>See you at Diwali Night. Your registration has been recorded.</p>
      <button onclick="closeModal()">Close</button>
    </div>
  </div>
</div>

<script>
let guests = [];
let step = 1;

function updateTotal() {
  let mainGender = document.getElementById('main_gender').value;
  let males = 0, females = 0;

  if (mainGender === 'Male') males++;
  else if (mainGender === 'Female') females++;

  // loop through guest fields dynamically
  let guestElems = document.querySelectorAll('#guestsContainer .person-fields');
  guestElems.forEach(g => {
    let gender = g.querySelector('.guestGender').value;
    if (gender === 'Male') males++;
    else if (gender === 'Female') females++;
  });

  // calculate couples and remaining singles
  let couples = Math.min(males, females);
  let remainingMales = males - couples;
  let remainingFemales = females - couples;

  // calculate total amount
  let total = (couples * 2500) + (remainingMales * 2000) + (remainingFemales * 1500);

  // update UI
  document.getElementById('totalAmount').innerText =
    `üí∞ ‚Çπ${total} ‚Äî Couples: ${couples}, Single Males: ${remainingMales}, Single Females: ${remainingFemales}`;

  return total;
}



// Step navigation
document.getElementById('next1').onclick = () => {
  if(!document.getElementById('main_name').value || !document.getElementById('main_instagram').value || !document.getElementById('main_mobile').value || !document.getElementById('main_email').value || !document.getElementById('main_gender').value){
    alert('Please fill all fields'); return;
  }
  step=2; showStep();
  updateTotal();
};
document.getElementById('back2').onclick = ()=>{ step=1; showStep(); };
document.getElementById('next2').onclick = ()=>{ step=3; showStep(); updateTotal(); };
document.getElementById('back3').onclick = ()=>{ step=2; showStep(); };

function showStep(){
  document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
  document.getElementById('step'+step).classList.add('active');
}

// Guest handling
document.getElementById('addGuest').onclick = () => {
  let container = document.getElementById('guestsContainer');
  let div = document.createElement('div');
  div.className='person-fields';
  div.innerHTML = `
    <h4>Guest</h4>
    <input class="input guestName" placeholder="Full name" required>
    <input class="input guestInstagram" placeholder="Instagram handle" required>
    <select class="input guestGender" required>
      <option value="">Select gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>
    <button type="button" class="btn secondary removeGuest">Remove</button>
  `;
  container.appendChild(div);

  div.querySelector('.removeGuest').onclick = ()=>{
    div.remove();
    updateTotal();
  };
};

// Form submission
document.getElementById('diwaliForm').onsubmit = async (e)=>{
  e.preventDefault();
  let main_name = document.getElementById('main_name').value;
  let main_instagram = document.getElementById('main_instagram').value;
  let main_mobile = document.getElementById('main_mobile').value;
  let main_email = document.getElementById('main_email').value;
  let main_gender = document.getElementById('main_gender').value;
  let upiTxn = document.getElementById('upiTxn').value;
  let totalAmount = updateTotal();

  // Guests data
  let guestElems = document.querySelectorAll('#guestsContainer .person-fields');
  let guestData = [];
  guestElems.forEach((g,i)=>{
    let name = g.querySelector('.guestName').value;
    let insta = g.querySelector('.guestInstagram').value;
    let gender = g.querySelector('.guestGender').value;
    if(name && insta && gender) guestData.push({name, instagram:insta, gender});
  });

  // Screenshot
  let screenshotFile = document.getElementById('screenshot').files[0];
  if(!screenshotFile){ alert('Please upload payment screenshot'); return; }
  let reader = new FileReader();
  reader.onload = async function(){
    let base64 = reader.result;
    document.getElementById('loadingOverlay').style.display='flex';
    try{
      const res = await fetch("https://script.google.com/macros/s/AKfycbwPiFoZvfFdcQZ3S4xWv58I9HdrBBfjlH4yy2AHAO0O8pCr0ZfBAWluSIcNIl5Fx9YFhg/exec", {  // <-- replace with your Apps Script Web App URL
        method:'POST',
        body: JSON.stringify({
          main_name, main_instagram, main_mobile, main_email, main_gender,
          upiTxn, totalAmount,
          screenshotBase64: base64,
          screenshotName: screenshotFile.name,
          guests: guestData
        }),
        headers:{ 'Content-Type':'application/json' }
      });
      const data = await res.json();
      document.getElementById('loadingOverlay').style.display='none';
      if(data.status==='success'){
        document.getElementById('diwaliForm').reset();
        guests=[];
        document.getElementById('guestsContainer').innerHTML='';
        document.getElementById('totalAmount').innerText='‚Çπ0';
        showModal();
      }else{
        alert('Error: '+data.message);
      }
    }catch(err){
      document.getElementById('loadingOverlay').style.display='none';
      alert('Submission failed: '+err.message);
    }
  };
  reader.readAsDataURL(screenshotFile);
};

function showModal(){ document.getElementById('successModal').classList.add('show'); }
function closeModal(){ document.getElementById('successModal').classList.remove('show'); }
</script>
</body>
</html>


